<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset = "UTF-8">
        <meta name = "viewport" content="width=device-width, initial-scale=1.0">
        <title>Ben Austin > d3.js</title>
        <link rel = "stylesheet"
        href = "https://cdnjs.cloudfare.com/ajax/libs/normalize/7.0.0/normalize.min.css">
        <link rel = "stylesheet"
        href = "https://cdnjs.cloudfare.com/ajas/libs/font-awesome/5.11.2/css/all.css"
        integrity = "sha256-46qynGAkLSFpVbEBog43gvNhfr0j+BmwXdxFgVK/Kvc=" crossorigin="anonymous" />
        <script src="https://kit.fontawesome.com/1d82a883f3.js" crossorigin="anonymous"></script>
        <script src="https://d3js.org/d3.v6.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,900|Source+Sans+Pro:300,900&display=swap" rel="stylesheet">
        <link rel = "stylesheet" href = "css/style.css">
    </head>
    <body>
        <header>
            <div class= "logo">
                <li class= "logo-list">
                    <a class = "logo" href = "index.html">
                        <i class="fas fa-bold"></i>
                    </a>
                </li>
            </div>
            <button class = "nav-toggle" aria-label="toggle navigation">
                <span class = "hamburger"></span>
            </button>
            <nav class = "nav">
                <ul class="nav__list">
                    <li class = "nav__item"><a href = "index.html" class = "nav__link">Home</a></li>
                    <li class = "nav__item"><a href = "index.html#services" class = "nav__link">My Services</a></li>
                    <li class = "nav__item"><a href = "index.html#about" class = "nav__link">About me</a></li>
                    <li class = "nav__item"><a href = "index.html#work" class = "nav__link">My Work</a></li>
                    <li class = "nav__item"><a href = "d3_page.html" class = "nav__link">d3.js</a></li>
                </ul>
            </nav>
        </header>

        <section class="intro" id="home">
            <h1 class = "section__title section__title--intro">
                Learning <strong>d3.js</strong>
            </h1>
            <p class = "section__subtitle section__subtitle--intro"></p>
            <img src="img/d3.png" class = "intro__image">
        </section>


        <!-- d3 content -->

        <section class = "d3-post">
            <div class = "d3-post d3-post--subtitle">
                <p class = "d3-post d3-post--subtitle--text">
                    Importing d3.js to work in your file, and setup
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                    d3.js is a custom JavaScript Library which has the power to link data with Scalable Vector Graphics (SVGs)
                    and HTML to create stunning visualisations. <br/> In order to get using d3.js in HTML files, we need to
                    give access to the d3.js library in a script tag. Within the index.html file, we need to include the following
                    link as a source for a script tag:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    &lt;script src = "https://d3js.org/d3.v6.js"&gt; &lt;/script&gt;
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                This will allow the use of d3 within the webpage. <br/> The next step is to create the space for the visualisation.
                In order to do this, we will use a div, with an id. This will allow us to target this div within our d3.js code later on. To create this div, 
                include the following as an attribute of your div tag:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    &lt;div id = "my_dataviz"&gt;&lt;/div&gt;
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                The meta tag for UTF-8 is also recommended, so it is best to include this tag in the head too: 
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    &lt;meta charset = "UTF-8"&gt;
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                The final thing we need to get things working is a final script tag. This will link to our JavaScript file, where we will write
                our JavaScript code to form the visualisation using d3.js. <br/> We can embed the script tag inside the div, so that the location
                of our visualisation looks like the following:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    &lt;div id="my_dataviz" class="my_dataviz"&gt; <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;script src="js/d3.js"&gt;&lt;/script&gt; <br/>
                    &lt;/div&gt;
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                We are now ready to start using d3.js <br/> <br/>
            </p>
            <div class = "d3-post d3-post--subtitle">
                <p class = "d3-post d3-post--subtitle--text">
                    A basic d3.js visualisation
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                In this section we are going to step through making our first basic visualisation. The bar chart:
            </p>
            <div id="my_dataviz" class="my_dataviz">
            </div>
            <p class = "d3-post d3-post--content--text">
                There are a few steps to get something like what is shown above up and running, the first is to setup some variables
                in our JavaScript file. In order to dial in the parameters for the size of the visualisation, we need 3 variables at the 
                top of our .js file; margin, width and height. Margin is a list of 4 numbers corresponding to pixel sized margins on each edge of 
                the visualisation. The width and heights are also numbers, but minusing off the size of the margins. This allows the number 
                at the start of the variable to be the maximum size of the svg that we will generate later on. <br/> <br/> These variables can differ
                but may resemble the following code chunk:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    const margin = {top: 30, right: 30, bottom: 70, left: 60}, <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;width = 460 - margin.left - margin.right,<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;height = 400 - margin.top - margin.bottom;
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                Now that we have the size of our visualisation, we can append an svg object within the div that we created earlier.
                To do this we will define a variable called "svg", which will select all div's with the id that we used, append some attributes
                that will define the size of the svg, and then append a group tag, which acts similarly to grouping objects in MicroSoft Office. The result looks like this:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    const svg = d3.select("#my_dataviz") <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;.append("svg")<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.attr("width", width + margin.left + margin.right)<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.attr("height", height + margin.top + margin.bottom)<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;.append("g")<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.attr("transform", `translate(${margin.left},${margin.top})`);
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                Let's step through the code in this section <br/> <br/>
                The first line: "const svg = d3.select("#my_dataviz")" creates a variable called svg, which asks d3 to final all html tags with the id of "my_dataviz". 
                The only one in our code with this id is the one we created earlier, so that is where the visualisation will be displayed. You could have multiple though
                if you wanted to display the same visualisation in multiple sections of a webpage. In this case we would need to use d3.selectAll("#my_dataviz"). <br/> <br/>
                The second line appends an svg object within our div element. The third and fourth lines then set the size of this svg object using the variables that we defined above.
                Notice that we add the margin widths to the size of the svg, this will allow us to only use the height and width when creating the visualisation and thus ensure everything 
                that we plot is within the svg space. A 'g' tag is then appened too. This allows all further objects that are drawn to be grouped together, so that any changes to where we
                display the graph, i.e. if we need to translate it, will apply to all elements.
            </p>
            <p class = "d3-post d3-post--content--text">
                Next we need to parse some data to draw our objects with, we can parse a simple csv by doing the following:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    d3.csv("link_here") <br/>
                    .then( function(data) {
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                We chain ".then(function(data) {" to tell d3 what to do with the data we just gave it, the next sections will all be inside this function.
            </p>
            <p class = "d3-post d3-post--content--text">
                The next step is to deal with the x axis. We need to tell d3 how to space our inputs for the graph. In the case of a bar chart we need to use "scaleBand()"
                to generate the bands on the x axis for our data. We do this using the following:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    const x = d3.scaleBand() <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .range([ 0, width ]) <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .domain(data.map(d => d.Country))<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .padding(0.2);
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                Here we are defining a function called "x". We give scaleBand() a range and domain of the function, as we want it to take in our countries and pass out a band on 
                our x axis, we give it a domain on our country list, and range of 0 to the width we defined earlier. We also don't want the bars touching, so we give it a padding too.
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    svg.append("g") <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .attr("transform", "translate(0," <br/> 
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + height + ")") <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .call(d3.axisBottom(x)) <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .selectAll("text") <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .attr("transform", "translate(-10,0)rotate(-45)") <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .style("text-anchor", "end");
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                We now need to draw the x axis. To do this, we need to append a group tag to the svg variable we made earlier. This is chained the attribute "transform" to
                shift it's location to start at the origin. We then call a d3 function "axisBottom(x)" to draw the line. Adding selectAll("text") with a transformation and some style
                will plot the names of the countries at their locations along the x axis. <br/> <br/>
                Now onto dealing with the y axis, similarly we need another function:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    const y = d3.scaleLinear() <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;.domain([0, 13000]) <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;.range([height, 0]); <br/>
                    svg.append("g") <br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;.call(d3.axisLeft(y));
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                This function is very similar to the one for the x axis, but we use scaleLinear() instead. This is because the y values are continuous. We pass the range and domain similarly.
                Notice that the range is given as "[height,0]" rather than "[0,height]" This is because the top left point of an svg is (0,0) rather than in the cartesian plane where the bottom left is (0,0).
                The 4th and 5th lines are to draw the y-axis.<br/> <br/>
                Now we have all of the components needed to plot our data. Let's step through this next code block line by line again:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    svg.selectAll("mybar")<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .data(data)<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; .join("rect")<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;.attr("x", d => x(d.Country))<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;.attr("y", d => y(d.Value))<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;.attr("width", x.bandwidth())<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;.attr("height", d => height - y(d.Value))<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;.attr("fill", "#4bbfc9")<br/>
                    })
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                The 1st line is telling d3 to select all bars, we can do this even if they are yet to be created. We need selectAll as we are plotting multiple.
                The 2nd line gives data to d3 to plot with, remember we are still inside the function at this stage. The 3rd line tells d3 to join a rectangle for each datapoint.
                The 4th through 8th lines are defining attributes on each rectangle. the x and y points are provided by our functions from earlier. Similarly with the width and height.
                Notice that we have "height - y(d.Value)" as a result of the swapped range of the y function. The fill is then chained on last. <br/> <br/> 
                We are finished! We have our first bar chart made with d3.js!<br/>
            </p>
            <div id="my_dataviz2" class="my_dataviz">
            </div>
            <br/>
            <div class = "d3-post d3-post--subtitle">
                <p class = "d3-post d3-post--subtitle--text">
                    A scatter plot visualisation
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                Before moving on to some more complex visualisations with d3, it's a good idea to make sure we have a solid knowledge of some other basic visualisations; next on the list is the scatter plot.
                We'll include some animation with this one too!
            </p>  
            <div id="scatter_d3_1" class="my_dataviz"></div>
            <p class = "d3-post d3-post--content--text">
                The idea of this visualisation is that we plot an initial state, and then update the position of the points when we want to trigger the visualisation animation. Plotting the initial state is very
                similar to the above bar chart, the only change is that we set the inital y co-ordinate to be on the x axis. To do this, we chain the following:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    .attr("cx", d => scatter_x(d.pounds)) <br/>
                    .attr("cy", scatter_height)
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                The hardest part of this visualisation is the animation. I wanted it to trigger once scrolled onto, which requires some neat JavaScript called "ScrollMagic". Which can be sourced with this link:<br/> <br/>
                https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.8/ScrollMagic.js <br/> <br/> We need the following code in our d3 file:
            </p>
            <div class = "d3-post d3-post--code">
                <p class = "d3-post d3-post--code--text">
                    function update() {<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;points.transition()<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.ease(d3.easePolyInOut.exponent(3))<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.duration(2000)<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.attr("cy", d => scatter_y(d.units))}<br/>
                    <br/>
                    var controller = new ScrollMagic.Controller();<br/>
                    new ScrollMagic.Scene({<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;// the element to scroll inside<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;triggerElement: '#scatter_d3_1'<br/>
                    })<br/>
                    .on('enter', function(e) {<br/>
                    &nbsp; &nbsp; &nbsp; &nbsp;update(e);<br/>
                    }).addTo(controller)
                </p>
            </div>
            <p class = "d3-post d3-post--content--text">
                The first part is defining the update function, this defines what changes we want once the animation is triggered. In our chase this is just changing the height of the points, I've chosen to ease this over 2000ms. 
                There are loads of different ease animations, more can be found here: <br/> <br/> <a href ="https://observablehq.com/@d3/easing-animations">https://observablehq.com/@d3/easing-animations</a> <br/> <br/>
                The next job is to create the controller for the animation. This is simple with ScrollMagic, we just create a new variable called "controller". We then need a new scene, this tells ScrollMagic what div we are wanting to animate.
                In our case this is has the ID: "scatter_d3_1". Finally we tell ScrollMagic that on entering this div, we want to trigger the function we defined earlier, and then add this logic to the controller object. Note that the default is triggered 
                when the vertical middle of the screen hits the top of the div, but this can be changed. The way that I have built this approach is very versitile, all that would need to be changed is the content of the update 
                function to tailor the animation. The approach where you draw all elements in an intial state will improve speed of page loading. Just like that! We have animation!
            </p>
        </section>

        <footer class = "footer">
            <a href="mailto:benaustin27@gmail.com" class = "footer__link">benaustin27@gmail.com</a>
            <ul class = "social-list">
                <li class = "social-list__item">
                    <a class = "social-list__link" href = "facebook.com">
                        <i class="fab fa-facebook"></i>
                    </a>
                </li>
                <li class = "social-list__item">
                    <a class = "social-list__link" href = "instagram.com">
                        <i class="fab fa-instagram"></i>
                    </a>
                </li>
                <li class = "social-list__item">
                    <a class = "social-list__link" href = "github.com">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
            </ul>
        </footer>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.8/ScrollMagic.js" integrity="sha512-UgS0SVyy/0fZ0i48Rr7gKpnP+Jio3oC7M4XaKP3BJUB/guN6Zr4BjU0Hsle0ey2HJvPLHE5YQCXTDrx27Lhe7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/index.js"></script>
        <script src="js/d3_basic_bar.js"></script>
        <script src="js/d3_basic_scatter.js"></script>
        </div>
    </body>
</html>